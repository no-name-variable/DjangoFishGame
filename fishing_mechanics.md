# Механика ловли рыбы

## Общая структура

В игре одновременно активны **до 3 удочек**. Удочки могут быть любой комбинации типов: поплавочная, фидерная, спиннинг. Игрок в любой момент выбирает **активную удочку** (клик по слоту или горячая клавиша 1/2/3).

---

## Поплавочная удочка

### Состояния поплавка

| Состояние | Описание | Анимация |
|-----------|----------|----------|
| `IDLE` | Нет активности | Поплавок лежит на воде, лёгкое покачивание |
| `NIBBLE` | Лёгкое подёргивание | Небольшие колебания вверх-вниз |
| `BITE` | Поклёвка | Поплавок резко уходит под воду, остаётся затоплен |

### Логика поклёвки

- Рыба подходит к приманке через случайный интервал
- Сначала фаза `NIBBLE` (1–3 сек), затем переход в `BITE`
- Окно подсечки: только во время фазы `BITE` (2–4 сек)
- После окна — рыба уходит, поплавок возвращается в `IDLE`

### Кнопка "Подсечь"

- Активна всегда, но результат зависит от состояния **активной** удочки
- Если активная удочка **не поплавочная** — показать соответствующее сообщение
- Если состояние `IDLE` или `NIBBLE` → toast: _"Сейчас поклёвки нет!"_
- Если состояние `BITE` → успешная подсечка → переход в режим **вываживания**

---

## Фидерная удочка

Аналогична поплавочной, но вместо анимации поплавка — **анимация кончика удилища (квивертип)**:

| Состояние | Анимация |
|-----------|----------|
| `NIBBLE` | Лёгкие подёргивания кончика |
| `BITE` | Резкий загиб книзу и удержание |

Подсечка и вываживание — по той же логике что у поплавочной.

---

## Спиннинг

Принципиально другая механика — **активная**.

### Проводка

После заброса начинается проводка:

- Игрок крутит катушку (зажатая кнопка или ритмичные нажатия)
- Леска плавно подтягивается к берегу
- Приманка движется по траектории от точки заброса к берегу
- Анимация лески: линия между удилищем и приманкой укорачивается по мере подмотки

### Поклёвка во время проводки

- Рыба атакует приманку в случайной точке траектории
- Визуально: резкий рывок — приманка дёргается, леска натягивается
- Игрок должен нажать **"Подсечь"** в течение короткого окна (1–2 сек)
- Если пропустил — рыба сошла, проводка продолжается до берега

### Конец проводки без поклёвки

Приманка достигает берега → автоматически предлагается **повторный заброс**.

---

## Режим вываживания (общий для всех типов)

После успешной подсечки:

1. Появляется **индикатор напряжения лески** (шкала 0–100%)
2. Игрок тянет рыбу: зажимает кнопку или нажимает ритмично
3. Рыба сопротивляется: периодически делает рывки, увеличивая напряжение
4. Если напряжение достигает **100%** — обрыв лески, рыба уходит
5. Нужно **стравливать** (отпускать кнопку) при рывках, **тянуть** в паузах
6. Когда рыба подведена к берегу (прогресс 100%) — **успешный улов**

### Анимации при вываживании

- Леска натягивается/провисает в зависимости от напряжения
- Удилище гнётся пропорционально нагрузке
- Брызги воды при сильных рывках рыбы

---

## UI элементы

### Слоты удочек

- **3 слота** — всегда видны, активная подсвечивается
- На слоте поплавочной/фидерной — иконка состояния: спокойно / клюёт / поклёвка
- На слоте спиннинга — прогресс-бар проводки
- При поклёвке на **неактивной** удочке — мигание слота + звуковой сигнал

### Кнопки и индикаторы

| Элемент | Описание |
|---------|----------|
| Кнопка "Подсечь" | Одна кнопка, действует на активную удочку |
| Кнопка "Подмотка" | Только для спиннинга, управляет проводкой |
| Шкала напряжения | Появляется только в режиме вываживания |
| Toast-сообщения | Информируют об ошибках (нет поклёвки, не тот тип удочки и т.д.) |

---

## Диаграмма состояний (поплавочная / фидерная)

```
IDLE → (рыба подошла) → NIBBLE → (пауза 1-3с) → BITE → (подсечка) → ВЫВАЖИВАНИЕ
                                                       ↓ (время вышло)
                                                      IDLE
```

## Диаграмма состояний (спиннинг)

```
ЗАБРОС → ПРОВОДКА → (поклёвка в случайной точке) → BITE → (подсечка) → ВЫВАЖИВАНИЕ
              ↓ (дошла до берега без поклёвки)          ↓ (пропустил)
           ЗАБРОС ←─────────────────────────────── ПРОВОДКА продолжается
```
